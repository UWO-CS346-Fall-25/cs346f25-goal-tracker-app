<!-- Dashboard aggregates stats + quick actions for authenticated users -->
<div class="page-header">
  <h1>Dashboard</h1>

  <% if (user) { %>
    <p class="welcome-msg">
      Welcome back, <%= user.display_name || user.username || user.email %>!
    </p>
  <% } %>
</div>
<!-- Floating shortcuts (new goal, logout, etc.) -->
<%- include('partials/quick-actions', { csrfToken }) %>

<section class="stats-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin:1rem 0;">
  
  <div class="feature stat-card" data-bg="<%= cardPhotos?.[0]?.urls?.regular || '' %>">
    <div class="stat-overlay">
    <h3>Total Goals</h3>
    <p><strong><%= stats?.totalGoals || 0 %></strong></p>
  </div>
  </div>

  <div class="feature stat-card" data-bg="<%= cardPhotos?.[1]?.urls?.regular || '' %>">
    <div class="stat-overlay">
    <h3>Active Milestones</h3>
    <p><strong><%= stats?.activeMilestones || 0 %></strong></p>
  </div>
</div>

  <div class="feature stat-card" data-bg="<%= cardPhotos?.[2]?.urls?.regular || '' %>">
    <div class="stat-overlay">
    <h3>Logs This Week</h3>
    <p><strong><%= stats?.logsThisWeek || 0 %></strong></p>
  </div>
</section>
</div>

<script>
  // Apply Unsplash photography to stat cards after render
  document.querySelectorAll('.stat-card').forEach(card => {
    const bg = card.dataset.bg;
    if (bg) {
      card.style.backgroundImage = `url(${bg})`;
    }
  });
</script>

<section style="margin-top:2rem;">
  <h2>Weekly Completion</h2>
  <!-- Chart.js can hydrate the canvas by reading data-* payloads from server -->
  <canvas id="progressChart"
          width="600" height="260"
          data-labels='<%- JSON.stringify(chart?.labels || []) %>'
          data-values='<%- JSON.stringify(chart?.values || []) %>'>
  </canvas>
</section>
