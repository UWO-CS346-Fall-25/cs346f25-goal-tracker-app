<!-- 
  Login Page Template
  Renders the login form for user authentication.
  Form submits to POST /users/login (handled by userController.postLogin)
-->

<!-- Page heading -->
<h1 style="margin-bottom:1rem;">Login</h1>

<!-- 
  Error Display Section
  Shows validation or authentication errors from the controller.
  The 'errors' array is passed from userController.postLogin when login fails.
-->
<% if (typeof errors !== 'undefined' && errors.length) { %>
  <div class="alert alert-danger" style="margin-bottom:1rem;">
    <ul style="margin:0; padding-left:1.25rem;">
      <!-- Loop through each error and display it as a list item -->
      <% errors.forEach(e => { %><li><%= e.msg || e %></li><% }) %>
    </ul>
  </div>
<% } %>

<!-- 
  Login Form
  method="POST" - Submits data securely via HTTP POST
  action="/users/login" - Routes to userController.postLogin
-->
<form method="POST" action="/users/login" data-validate>
  <!-- 
    CSRF Token (Cross-Site Request Forgery Protection)
    Hidden field with security token generated by csurf middleware.
    Server validates this to ensure the request originated from our application.
  -->
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <!-- 
    Email Input Field
    - name="email" - Sent to server as req.body.email
    - type="email" - Browser validates email format
    - required - Prevents empty submission
    - value - Preserves user input on failed login attempt
  -->
  <div class="form-group" style="margin-bottom:1rem;">
    <label for="email">Email</label>
    <input id="email" name="email" type="email" required autocomplete="email"
    value="<%= (values && values.email) ? values.email : '' %>"
    >
  </div>

  <!-- 
    Password Input Field
    - name="password" - Sent to server as req.body.password
    - type="password" - Masks input characters
    - required - Prevents empty submission
    - No value attribute for security (never pre-fill passwords)
  -->
  <div class="form-group" style="margin-bottom:1rem;">
    <label for="password">Password</label>
    <input id="password" name="password" type="password" required autocomplete="current-password">
  </div>

  <!-- 
    Submit Button
    Submits form to userController.postLogin which validates credentials 
    via Supabase Auth, creates session on success, or returns errors on failure.
  -->
  <button class="btn" type="submit">Log In</button>
</form>

<!-- 
  Registration Link
  Links to /users/register for new user account creation.
-->
<p style="margin-top:1rem;">
  Don't have an account? <a href="/users/register">Register</a>
</p>